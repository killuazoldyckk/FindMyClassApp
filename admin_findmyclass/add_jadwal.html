<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class Schedule Form</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        *{
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        .formContent{
            height: 100vh;
        }

        .formJadwal{
            background-color : #f8e505;
            justify-content : center;
            height: 80%;
            width: 80%;
            border-radius: 2rem;
            align-items: center;
        }

        .classData{
            height: 100vh;
        }

        .sched_collection{
            height: 100vh;
            overflow-y: scroll;
        }

        .sched_collection h2{
            color: #f8e505;
        }

        .sched_collection button{
            background-color: #f8e505;
        }

        .sched_collection button:hover{
            background-color: #ffc107;
        }

        .fab {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #007BFF;
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 50px; /* Set a fixed width for the circle */
            height: 50px; /* Set a fixed height for the circle */
            font-size: 16px;
            cursor: pointer;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 1000; /* Set a high z-index to ensure it's above other elements */
            display: flex;
            align-items: center;
            justify-content: center;
        }

    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg bg-primary">
        <div class="container-fluid">
          <a class="navbar-brand text-light" href="#">FindMyClass</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
              <li class="nav-item">
                <a class="nav-link active text-light" aria-current="page" href="#">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link text-light" href="report.html">Report</a>
              </li>
              <li class="nav-item">
                <a class="nav-link text-light" href="activity.html">Acitvity</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    <div class="row gx-0">
        <div class="formContent col-md-6 bg-primary d-flex align-items-center justify-content-center">
            <form id="jadwalForm"class="formJadwal row p-4">
                <h2 class="text-center mb-3 text-primary">Daftar Jadwal Ruangan</h2>
                <div class="col-md-6" >
                    <label for="namaRuang" class="form-label ">Kode Kelas:</label>
                    <input type="number" name="namaRuang" id="namaRuang" class="form-control" placeholder="101" required>
                </div>
                <div class="col-md-6">
                    <label for="hari" class=" form-label">Hari:</label>
                    <select id="hari" name="hari" class="form-select" required>
                        <option value="Senin">Senin</option>
                        <option value="Selasa">Selasa</option>
                        <option value="Rabu">Rabu</option>
                        <option value="Kamis">Kamis</option>
                        <option value="Jumat">Jumat</option>
                    </select>
                </div>

                <div class="col-md-12" >
                    <label for="matkul" class="form-label">Mata Kuliah:</label>
                    <input type="text" name="matkul" id="matkul" class="form-control" placeholder="Cloud Computing" required>
                </div>                

                <div class="col-md-6">
                    <label for="waktu" class="form-label">Waktu :</label>
                    <br>
                    <div class="btn-group w-100" >
                        <button class="btn btn-light dropdown-toggle text-start" type="button"  data-bs-toggle="dropdown" aria-expanded="false">
                            Pilih Waktu
                            <span class="visually-hidden text-end">Toggle Dropdown</span>
                        </button>
                        <ul class="dropdown-menu w-100">
                            <li>
                                <div class="form-check">
                                    <input type="checkbox" id="waktu_1" name="waktu[]" value="08.00 - 08.50">
                                    <label for="waktu_1" class="form-label">08.00 - 08.50</label>
                                </div>
                            </li>
                            <li>
                                <div class="form-check">
                                    <input type="checkbox" id="waktu_2" name="waktu[]" value="08.50 - 09.40">
                                    <label for="waktu_2" class="form-label">08.50 - 09.40</label>
                                </div>
                            </li>
                            <li>
                                <div class="form-check">
                                    <input type="checkbox" id="waktu_3" name="waktu[]" value="09.40 - 10.30">
                                    <label for="waktu_3" class="form-label">09.40 - 10.30</label>
                                </div>
                            </li>
                            <li>
                                <div class="form-check">
                                    <input type="checkbox" id="waktu_4" name="waktu[]" value="10.30 - 11.20">
                                    <label for="waktu_4" class="form-label">10.30 - 11.20</label>
                                </div>
                            </li>
                            <li>
                                <div class="form-check">
                                    <input type="checkbox" id="waktu_5" name="waktu[]" value="11.20 - 12.10">
                                    <label for="waktu_5" class="form-label">11.20 - 12.10</label>
                                </div>
                            </li>
                            <li>
                                <div class="form-check">
                                    <input type="checkbox" id="waktu_6" name="waktu[]" value="12.10 - 13.00">
                                    <label for="waktu_6" class="form-label">12.10 - 13.00</label>
                                </div>
                            </li>
                            <li>
                                <div class="form-check">
                                    <input type="checkbox" id="waktu_7" name="waktu[]" value="13.00 - 13.50">
                                    <label for="waktu_7" class="form-label">13.00 - 13.50</label>
                                </div>
                            </li>
                            <li>
                                <div class="form-check">
                                    <input type="checkbox" id="waktu_8" name="waktu[]" value="13.50 - 14.40">
                                    <label for="waktu_8" class="form-label">13.50 - 14.40</label>
                                </div>
                            </li>
                            <li>
                                <div class="form-check">
                                    <input type="checkbox" id="waktu_9" name="waktu[]" value="14.40 - 15.30">
                                    <label for="waktu_9" class="form-label">14.40 - 15.30</label>
                                </div>
                            </li>
                            <li>
                                <div class="form-check">
                                    <input type="checkbox" id="waktu_10" name="waktu[]" value="15.30 - 16.20">
                                    <label for="waktu_10" class="form-label">15.30 - 16.20</label>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>


                <div class="col-md-3">
                    <label for="kom" class=" form-label">Kom:</label>
                    <select id="kom" name="kom" class="form-select" required>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="stambuk" class=" form-label">Stambuk:</label>
                    <input type="text" name="stambuk" id="stambuk" class="form-select" placeholder="2021" required>
                </div>

                
                <input type="submit" value="Submit" class="btn btn-primary mt-2">
            </form>  
        </div>
        <div class="jadwalContent col-md-6">
            <!-- Display data -->
            <div id="classroomData" class="classData bg-primary">
                <div class="sched_collection p-4">
                    <h2 class="text-center mb-3">Schedule Registred</h2>
                    <!-- <div class="btn-group">
                        <button type="button" class="btn dropdown-toggle " data-bs-toggle="dropdown" aria-expanded="false">
                            Urutkan berdasarkan
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#" id="sortByHari">Hari</a></li>
                            <li><a class="dropdown-item" href="#" id="sortByKelas">Kelas</a></li>
                        </ul>
                    </div> -->
                    <div id="scheduleContainer" class="overflow-auto mt-3">
                        <!-- Schedule data will be dynamically added here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Add this modal structure to your HTML -->
        <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editModalLabel">Edit Schedule</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <!-- Editable fields -->
                        <label for="editNamaRuang" class="form-label">Kode Kelas:</label>
                        <input type="number" id="editNamaRuang" class="form-control" required>

                        <label for="editHari" class="form-label">Hari:</label>
                        <select id="editHari" name="hari" class="form-select" required>
                            <option value="Senin">Senin</option>
                            <option value="Selasa">Selasa</option>
                            <option value="Rabu">Rabu</option>
                            <option value="Kamis">Kamis</option>
                            <option value="Jumat">Jumat</option>
                        </select>

                        <label for="editMatkul" class="form-label">Mata Kuliah:</label>
                        <input type="text" id="editMatkul" class="form-control" required>

                        <label for="editWaktu" class="form-label">Waktu :</label>
                        <div class="btn-group w-100" >
                            <button class="btn btn-light dropdown-toggle text-start" type="button"  data-bs-toggle="dropdown" aria-expanded="false">
                                Pilih Waktu
                                <span class="visually-hidden text-end">Toggle Dropdown</span>
                            </button>
                            <ul class="dropdown-menu w-100">
                                <li>
                                    <div class="form-check">
                                        <input type="checkbox" id="waktu_1" name="updateWaktu[]" value="08.00 - 08.50">
                                        <label for="waktu_1" class="form-label">08.00 - 08.50</label>
                                    </div>
                                </li>
                                <li>
                                    <div class="form-check">
                                        <input type="checkbox" id="waktu_2" name="updateWaktu[]" value="08.50 - 09.40">
                                        <label for="waktu_2" class="form-label">08.50 - 09.40</label>
                                    </div>
                                </li>
                                <li>
                                    <div class="form-check">
                                        <input type="checkbox" id="waktu_3" name="updateWaktu[]" value="09.40 - 10.30">
                                        <label for="waktu_3" class="form-label">09.40 - 10.30</label>
                                    </div>
                                </li>
                                <li>
                                    <div class="form-check">
                                        <input type="checkbox" id="waktu_4" name="updateWaktu[]" value="10.30 - 11.20">
                                        <label for="waktu_4" class="form-label">10.30 - 11.20</label>
                                    </div>
                                </li>
                                <li>
                                    <div class="form-check">
                                        <input type="checkbox" id="waktu_5" name="updateWaktu[]" value="11.20 - 12.10">
                                        <label for="waktu_5" class="form-label">11.20 - 12.10</label>
                                    </div>
                                </li>
                                <li>
                                    <div class="form-check">
                                        <input type="checkbox" id="waktu_6" name="updateWaktu[]" value="12.10 - 13.00">
                                        <label for="waktu_6" class="form-label">12.10 - 13.00</label>
                                    </div>
                                </li>
                                <li>
                                    <div class="form-check">
                                        <input type="checkbox" id="waktu_7" name="updateWaktu[]" value="13.00 - 13.50">
                                        <label for="waktu_7" class="form-label">13.00 - 13.50</label>
                                    </div>
                                </li>
                                <li>
                                    <div class="form-check">
                                        <input type="checkbox" id="waktu_8" name="updateWaktu[]" value="13.50 - 14.40">
                                        <label for="waktu_8" class="form-label">13.50 - 14.40</label>
                                    </div>
                                </li>
                                <li>
                                    <div class="form-check">
                                        <input type="checkbox" id="waktu_9" name="updateWaktu[]" value="14.40 - 15.30">
                                        <label for="waktu_9" class="form-label">14.40 - 15.30</label>
                                    </div>
                                </li>
                                <li>
                                    <div class="form-check">
                                        <input type="checkbox" id="waktu_10" name="updateWaktu[]" value="15.30 - 16.20">
                                        <label for="waktu_10" class="form-label">15.30 - 16.20</label>
                                    </div>
                                </li>
                            </ul>
                        </div>
                        
                        <div class="col">
                            <label for="editKom" class=" form-label">Kom:</label>
                            <select id="editKom" name="editKom" class="form-select" required>
                                <option value="A">A</option>
                                <option value="B">B</option>
                                <option value="C">C</option>
                            </select>
                        </div>
                        <div class="col">
                            <label for="editStambuk" class=" form-label">Stambuk:</label>
                            <input type="text" name="stambuk" id="editStambuk" class="form-control" placeholder="2021" required>
                        </div>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" id="updateBtn" class="btn btn-primary">Save changes</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Floating Action Button -->
        <button class="fab" data-toggle="modal" data-target="#settingModal">+</button>

        <!-- Bootstrap Modal -->
        <div class="modal" id="settingModal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Setting</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <!-- Add more content for the modal body as needed -->
                        <button class="btn btn-primary" onclick="logout()">Logout</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, onValue,remove, set, query, orderByChild, equalTo, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyAGQ6CUM9ik5KcYeMe3zROC2tC0G06i75Y",
            authDomain: "findmyclassjava.firebaseapp.com",
            databaseURL: "https://findmyclassjava-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "findmyclassjava",
            storageBucket: "findmyclassjava.appspot.com",
            messagingSenderId: "362186543525",
            appId: "1:362186543525:web:ff24f5cd22d95ceb73d84c",
            measurementId: "G-4W36PE8TMW"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase();

        const jadwalForm = document.getElementById('jadwalForm');
        const classroomDataDiv = document.getElementById('classroomData');
        
        jadwalForm.addEventListener('submit', (e) => {
            e.preventDefault(); // Prevent form submission
        
            // Get form data
            var namaRuang = document.getElementById("namaRuang").value;
            var hari = document.getElementById("hari").value;
            var matkul = document.getElementById("matkul").value;
            var kom = document.getElementById("kom").value;
            var stambuk = document.getElementById("stambuk").value;
            var status = "Terisi";
        
            // Get selected time slots
            var selectedTimeSlots = [];
            var checkboxes = document.getElementsByName("waktu[]");
            checkboxes.forEach(function (checkbox) {
                if (checkbox.checked) {
                    selectedTimeSlots.push(checkbox.value);
                }
            });
        
            var jam = selectedTimeSlots.join(', ');
        
            // Reference to your Firebase Realtime Database
            var databaseRef = ref(database, 'classroom');
        
            // Query to check if data with the same namaRuang and hari exists
            const matchingNamaRuangQuery = query(
                databaseRef,
                orderByChild('namaRuang'),
                equalTo(namaRuang)
            );
        
            // Retrieve data based on the query
            get(matchingNamaRuangQuery)
                .then((snapshot) => {
                    // Get the total count of records in the "classroom" reference
                    return get(databaseRef)
                        .then(totalSnapshot => {
                            const totalRecords = totalSnapshot.val() ? Object.keys(totalSnapshot.val()).length : 0;
        
                            // Check if data with the same namaRuang and hari exists
                            if (snapshot.exists()) {
                                const matchingData = snapshot.val();
                                const isDataAlreadyExists = Object.values(matchingData).some(data => data.hari === hari && data.jam === jam);
        
                                if (isDataAlreadyExists) {
                                    const message = `Jadwal pada ruangan "${namaRuang}" pada hari "${hari}" dan waktu tersebut telah terisi. Mohon pilih jadwal lain.`;
                                    alert(message);
                                } else {
                                    // Data with the same namaRuang exists, but hari and jam are different. Proceed with form submission
                                    // Create JSON object with incremented schedID
                                    var formData = {
                                        namaRuang: namaRuang,
                                        hari: hari,
                                        matkul: matkul,
                                        jam: jam,
                                        status: status,
                                        kom: kom,
                                        stambuk: stambuk,
                                        schedID: (totalRecords + 1).toString()  // Incremented schedID as string
                                    };
        
                                    // Push data to the database
                                    push(databaseRef, formData)
                                        .then(() => {
                                            const savemessage = `Jadwal Berhasil Ditambahkan`;
                                            alert(savemessage);
                                            console.log("Data sent to Firebase Realtime Database!");
                                            document.getElementById("jadwalForm").reset();
                                        })
                                        .catch((error) => {
                                            console.error("Error sending data to Firebase Realtime Database: ", error);
                                        });
                                }
                            } else {
                                // No data with the same namaRuang. Proceed with form submission
                                var formData = {
                                    namaRuang: namaRuang,
                                    hari: hari,
                                    matkul: matkul,
                                    jam: jam,
                                    status: status,
                                    kom: kom,
                                    stambuk: stambuk,
                                    schedID: (totalRecords + 1).toString()  // Incremented schedID as string
                                };
        
                                // Push data to the database
                                push(databaseRef, formData)
                                    .then(() => {
                                        console.log("Data sent to Firebase Realtime Database!");
                                        document.getElementById("jadwalForm").reset();
                                    })
                                    .catch((error) => {
                                        console.error("Error sending data to Firebase Realtime Database: ", error);
                                    });
                            }
                        });
                })
                .catch((error) => {
                    console.error("Error querying data from Firebase Realtime Database: ", error);
                });
        });
        
        function mergeTime(jam) {
            // Split the string into individual time ranges
            const individualRanges = jam.split(", ");
        
            // Extract start and end times from each range
            const startTimes = individualRanges.map(range => parseFloat(range.split(" - ")[0]));
            const endTimes = individualRanges.map(range => parseFloat(range.split(" - ")[1]));
        
            // Find the minimum start time and maximum end time
            const minStartTime = Math.min(...startTimes);
            const maxEndTime = Math.max(...endTimes);
        
            // Combine the min and max times to create the new range
            const combinedRange = `${minStartTime.toFixed(2)} - ${maxEndTime.toFixed(2)}`;
        
            // Return the result
            return combinedRange;
        }

        const scheduleContainer = document.getElementById('scheduleContainer');
        const classroomRef = ref(database, 'classroom');

        // Function to delete a schedule
        window.deleteSchedule = function (key, namaRuang, hari, matkul, jam, kom, stambuk) {
            // Display a confirmation dialog
            const isConfirmed = window.confirm("Are you sure you want to delete this schedule?");

            if (isConfirmed) {
                // Construct the criteriaToDelete object
                const criteriaToDelete = {
                    namaRuang: namaRuang,
                    hari: hari,
                    matkul: matkul,
                    jam: jam,
                    kom: kom,
                    stambuk: stambuk
                };

                // Create a reference to the specific data using the key
                const dataRefToDelete = ref(database, `classroom/${key}`);

                // Remove the data from the database
                remove(dataRefToDelete)
                    .then(() => {
                        console.log("Data deleted successfully!");
                    })
                    .catch((error) => {
                        console.error("Error deleting data:", error);
                    });
            } else {
                console.log("Deletion canceled.");
            }
        }

        // Function to render schedule data
        function renderSchedule(snapshot) {
            const scheduleData = snapshot.val();
            scheduleContainer.innerHTML = ''; // Clear previous content

            for (const key in scheduleData) {
                const schedule = scheduleData[key];
                let jam = schedule.jam;
                
                const mergeJam = mergeTime(schedule.jam);

                const scheduleHTML = `
                    <div class="mb-3 p-3" style="background-color: #f8e505; border-radius: 1rem;">
                        <h4>${schedule.namaRuang}</h4>
                        <p>${schedule.matkul}</p>
                        <p>Kom ${schedule.kom} ${schedule.stambuk}</p>
                        <p>${schedule.hari}, ${mergeJam}</p>
                        <div class="m-2 text-end">
                            <i class="editIcon fa-solid fa-pen-to-square fa-lg" style="color: #497eda;cursor: pointer;" onclick="openEditModal('${key}', '${schedule.namaRuang}', '${schedule.hari}', '${schedule.matkul}', '${schedule.jam}', '${schedule.kom}', '${schedule.stambuk}')"></i>
                            <i class="deleteIcon fa-solid fa-trash fa-lg" style="color: red;cursor: pointer;" data-key="${key}" onclick="deleteSchedule('${key}', '${schedule.namaRuang}', '${schedule.hari}', '${schedule.matkul}', '${schedule.jam}', '${schedule.kom}', '${schedule.stambuk}')"></i>
                        </div>
                    </div>
                `;
                scheduleContainer.innerHTML += scheduleHTML;
            }
        }

        // Function to open the modal with data for editing
        window.openEditModal = function (key, namaRuang, hari, matkul, jam, kom, stambuk) {

            // Populate the modal with existing data
            document.getElementById("editNamaRuang").value = namaRuang;
            document.getElementById("editHari").value = hari;
            document.getElementById("editMatkul").value = matkul;
            document.getElementById("editKom").value = kom;
            document.getElementById("editStambuk").value = stambuk;

            // Uncheck all checkboxes first
            var allCheckboxes = document.getElementsByName("updateWaktu[]");
            allCheckboxes.forEach(function (checkbox) {
                checkbox.checked = false;
            });
            var timeSlots = jam.split(",");
            console.log(timeSlots);

            timeSlots.forEach(function (timeSlot) {
                // Trim any leading or trailing spaces
                timeSlot = timeSlot.trim();
            
                // Find the checkbox with the corresponding value
                var checkbox = document.querySelector('input[name="updateWaktu[]"][value="' + timeSlot + '"]');
                
                if (checkbox) {
                    checkbox.checked = true;
                } else {
                    console.log("Checkbox not found for time slot:", timeSlot);  // Add this line for debugging
                }
            });

            // Show the modal
            $('#editModal').modal('show');

            // Define a function to handle the update when the "Save" button is clicked
            document.getElementById("updateBtn").onclick = function () {
                // Retrieve updated data from the modal
                var updatedNamaRuang = document.getElementById("editNamaRuang").value;
                var updatedHari = document.getElementById("editHari").value;
                var updatedMatkul = document.getElementById("editMatkul").value;
                var updatedKom = document.getElementById("editKom").value;
                var updatedStambuk = document.getElementById("editStambuk").value;
            
                var selectedUpdateTimeSlots = [];
                var updatedCheckboxes = document.getElementsByName("updateWaktu[]");
                updatedCheckboxes.forEach(function(checkbox) {
                    if (checkbox.checked) {
                        selectedUpdateTimeSlots.push(checkbox.value);
                    }
                });

                console.log("updatedNamaRuang:", updatedNamaRuang);
                console.log("updatedHari:", updatedHari);
            
                var updatedJam = selectedUpdateTimeSlots.join(', ');
                console.log("updatedJam:", updatedJam);

                // Create a reference to the specific data using the key
                const dataRef = ref(database, 'classroom');
            
                // Query to check if data with the same namaRuang and hari exists
                const cekData = query(
                    dataRef,
                    orderByChild('namaRuang'),
                    equalTo(updatedNamaRuang)
                );
            
                // Retrieve existing data for the key
                get(cekData)
                    .then((snapshot) => {
                        console.log("Snapshot:", snapshot.val());
                        if (snapshot.exists()) {
                            // Data with the same namaRuang exists, check for matching hari and jam
                            const matchingData = snapshot.val();
                            const isConflict = Object.values(matchingData).some(data => data.hari === updatedHari && data.jam === updatedJam);
            
                            if (isConflict) {
                                const updaterejectmessage = `Jadwal pada ruangan "${updatedNamaRuang}" pada hari "${updatedHari}" dan waktu tersebut telah terisi. Mohon pilih jadwal lain.`;
                                alert(updaterejectmessage);
                            } else {
                                // No conflict, proceed with the update
                                const updatedData = {
                                    namaRuang: updatedNamaRuang,
                                    hari: updatedHari,
                                    matkul: updatedMatkul,
                                    kom: updatedKom,
                                    stambuk: updatedStambuk,
                                    jam: updatedJam
                                };
            
                                // Update the data in the database
                                set(dataRefToUpdate, updatedData)
                                    .then(() => {
                                        console.log("Data updated successfully!");
                                        const updateMessage = "Jadwal berhasil diperbarui";
                                        alert(updateMessage);
                                        $('#editModal').modal('hide');
                                    })
                                    .catch((error) => {
                                        console.error("Error updating data:", error);
                                    });
                            }
                        } else {
                            // Data does not exist, proceed with the update
                            // Construct the updated data object
                            var updatedData = {
                                namaRuang: updatedNamaRuang,
                                hari: updatedHari,
                                matkul: updatedMatkul,
                                kom: updatedKom,
                                stambuk: updatedStambuk,
                                jam: updatedJam
                            };

                            const dataRefToUpdate = ref(database, `classroom/${key}`);
            
                            // Update the data in the database
                            set(dataRefToUpdate, updatedData)
                                .then(() => {
                                    console.log("Data updated successfully!");
                                    const updatemessage = "Jadwal berhasil diperbarui";
                                    alert(updatemessage);
                                    $('#editModal').modal('hide');
                                })
                                .catch((error) => {
                                    console.error("Error updating data:", error);
                                });
                        }
                    })
                    .catch((error) => {
                        console.error("Error querying data from Firebase Realtime Database: ", error);
                    });
            };
            
    };
        

        // Listen for changes in the database and update the schedule
        onValue(classroomRef, renderSchedule);


    </script>
    <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>

</body>
</html>